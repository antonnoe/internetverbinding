<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Internetverbinding – Dataverbinding Frankrijk</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      color: #000000;
      margin: 0;
      padding: 20px;
      line-height: 1.5;
    }
    h1, h2 { color: #800000; margin-top: 0; }
    h3 { color: #555555; }
    .subtitle { color: #777777; margin-top: 4px; margin-bottom: 20px; }
    .container { max-width: 960px; margin: 0 auto; }
    
    /* Introductie */
    .intro-box {
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
    }

    /* Zoekveld en Dropdown styling */
    .search-container {
      position: relative;
      max-width: 100%;
    }
    label { font-weight: bold; display: block; margin-bottom: 6px; }
    
    .input-group {
      display: flex;
      gap: 10px;
    }
    input[type="text"] {
      flex-grow: 1;
      padding: 12px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #cccccc;
    }
    button.search-btn {
      background: #800000;
      color: #ffffff;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      white-space: nowrap;
    }
    button.search-btn:hover { opacity: 0.95; }

    /* De dropdown lijst met suggesties */
    #addressSuggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 4px 4px;
      z-index: 1000;
      max-height: 250px;
      overflow-y: auto;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: none; /* standaard verborgen */
    }
    .suggestion-item {
      padding: 10px 12px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }
    .suggestion-item:last-child { border-bottom: none; }
    .suggestion-item:hover { background-color: #f2e6e6; }
    .suggestion-context { font-size: 0.85em; color: #666; float: right; }

    .helper-text { font-size: 13px; color: #666666; margin-top: 8px; }

    /* Resultaten sectie */
    #results {
      margin-top: 30px;
      border-top: 2px solid #800000;
      padding-top: 20px;
      display: none;
    }
    .address-summary {
      font-size: 16px;
      background: #eef; 
      padding: 10px; 
      border-left: 4px solid #800000;
      margin-bottom: 20px;
    }

    /* Kaarten Grid */
    .tech-grid { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 24px; }
    .tech-card {
      flex: 1 1 260px;
      border: 1px solid #dddddd;
      border-radius: 10px;
      padding: 14px 16px;
      box-sizing: border-box;
      background: #ffffff;
    }
    .tech-card h3 { margin-top: 0; margin-bottom: 8px; color: #800000; }
    .pill {
      display: inline-block; font-size: 12px; padding: 2px 8px;
      border-radius: 999px; background: #f2e6e6; color: #800000; margin-bottom: 8px;
    }
    .tech-card ul { padding-left: 18px; margin: 6px 0; }
    .tech-card li { margin-bottom: 2px; }
    
    .links-list { font-size: 13px; margin-top: 6px; }
    .links-list a { color: #800000; text-decoration: none; }
    .links-list a:hover { text-decoration: underline; }

    /* Overige secties */
    .tips-box {
      background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px;
      padding: 14px 16px; margin-bottom: 24px;
    }
    .section { margin-top: 24px; }
    .section ul { padding-left: 18px; }
    .section a { color: #800000; text-decoration: none; }
    .section a:hover { text-decoration: underline; }

    footer {
      margin-top: 40px; font-size: 14px; color: #777;
      border-top: 1px solid #ddd; padding-top: 10px;
    }

    @media (max-width: 600px) {
      .input-group { flex-direction: column; }
      button.search-btn { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Internetverbinding</h1>
    <div class="subtitle">Dataverbinding Frankrijk</div>

    <div class="intro-box">
      <p>
        Zoek uw Franse adres in de officiële database (BAN). Selecteer het juiste adres uit de lijst om de algemene mogelijkheden te zien.
      </p>
      <p style="font-size:13px;color:#d32f2f; font-weight:bold;">
        ⚠️ Let op: Deze tool toont algemene info op basis van uw locatie. Wij hebben geen live toegang tot de kabels in uw straat. Gebruik de links bij de resultaten voor de definitieve check.
      </p>
    </div>

    <div class="search-container">
      <label for="addressInput">Zoek adres in Frankrijk</label>
      <form onsubmit="event.preventDefault(); fetchAddresses();">
        <div class="input-group">
          <input id="addressInput" type="text" placeholder="Bijv. 5 route du Village..." autocomplete="off">
          <button type="submit" class="search-btn">Zoek Adres</button>
        </div>
        <div id="addressSuggestions"></div>
      </form>
      <div class="helper-text">
        Typ een straat en plaats en klik op 'Zoek Adres'. Kies daarna uw adres uit de lijst.
      </div>
    </div>

    <div id="results">
      <h2>Mogelijkheden voor uw locatie</h2>
      
      <div class="address-summary">
        <strong>Geselecteerd adres:</strong> <span id="normalizedAddress"></span><br>
        <span style="font-size:13px; color:#666;">GPS Coördinaten: <span id="gpsCoords"></span> (Gebruikt voor satelliet-check)</span>
      </div>

      <div class="tech-grid" id="techCards">
        </div>

      <div class="tips-box">
        <h3>Wat is belangrijk?</h3>
        <ul>
          <li><strong>Glasvezel (Fibre):</strong> Altijd de beste keuze als het beschikbaar is.</li>
          <li><strong>4G/5G Box:</strong> Goed alternatief, maar test eerst de ontvangst met uw mobiel.</li>
          <li><strong>Starlink:</strong> Beste optie voor het platteland (buitengebied) zonder fibre.</li>
          <li><strong>ADSL/Satelliet (oud):</strong> Alleen doen als er écht niets anders is.</li>
        </ul>
      </div>

      <div class="section">
        <h3>Links voor definitieve bevestiging</h3>
        <p>Omdat wij geen live inzage hebben in de netwerken, moet u hier checken of het écht beschikbaar is:</p>
        <ul>
          <li>
            <strong>Overheid & Dekkingskaart:</strong> 
            <a href="https://maconnexioninternet.arcep.fr/" target="_blank">Ma Connexion Internet (Arcep)</a> (Vul hier ook uw adres in!)
          </li>
          <li>
            <strong>Mobiel Bereik:</strong>
            <a href="https://www.monreseaumobile.arcep.fr/" target="_blank">Mon Réseau Mobile</a>
          </li>
        </ul>
      </div>

      <div class="section">
        <h3>TV & VPN Diensten</h3>
        <ul id="tvList"></ul>
        <ul id="vpnList"></ul>
      </div>
    </div>

    <footer>
      Infofrankrijk.com en Nederlanders.fr. Data via api-adresse.data.gouv.fr.
    </footer>
  </div>

  <script>
    let providersData = null;

    // 1. Providers laden
    async function loadProviders() {
      try {
        const res = await fetch("providers_fr.json");
        if (res.ok) providersData = await res.json();
      } catch (e) {
        console.error("Fout laden JSON:", e);
      }
    }

    // 2. Adressen ophalen bij BAN (API)
    async function fetchAddresses() {
      const input = document.getElementById("addressInput");
      const suggestionsBox = document.getElementById("addressSuggestions");
      const query = input.value.trim();

      if (query.length < 3) return;

      suggestionsBox.style.display = "none";
      suggestionsBox.innerHTML = "<div class='suggestion-item'>Zoeken...</div>";
      suggestionsBox.style.display = "block";

      try {
        // We vragen nu 5 resultaten op (limit=5) ipv 1
        const url = "https://api-adresse.data.gouv.fr/search/?q=" + encodeURIComponent(query) + "&limit=5";
        const res = await fetch(url);
        if (res.ok) {
          const data = await res.json();
          renderSuggestions(data.features);
        } else {
          suggestionsBox.innerHTML = "<div class='suggestion-item'>Fout bij ophalen adressen.</div>";
        }
      } catch (e) {
        console.error(e);
        suggestionsBox.innerHTML = "<div class='suggestion-item'>Geen verbinding met API.</div>";
      }
    }

    // 3. Suggesties tonen in dropdown
    function renderSuggestions(features) {
      const suggestionsBox = document.getElementById("addressSuggestions");
      suggestionsBox.innerHTML = "";

      if (!features || features.length === 0) {
        suggestionsBox.innerHTML = "<div class='suggestion-item'>Geen adres gevonden. Probeer postcode + plaats.</div>";
        suggestionsBox.style.display = "block";
        return;
      }

      features.forEach(f => {
        const div = document.createElement("div");
        div.className = "suggestion-item";
        
        // Label opbouwen
        const label = f.properties.label;
        const context = f.properties.context || ""; // bijv "75, Paris, Île-de-France"
        
        div.innerHTML = `
          <strong>${label}</strong>
          <span class="suggestion-context">${context}</span>
        `;

        // Click event: adres kiezen
        div.onclick = () => selectAddress(f);
        
        suggestionsBox.appendChild(div);
      });

      suggestionsBox.style.display = "block";
    }

    // 4. Adres geselecteerd -> Toon resultaten
    function selectAddress(feature) {
      // Verberg dropdown
      document.getElementById("addressSuggestions").style.display = "none";
      
      // Vul input met gekozen adres
      document.getElementById("addressInput").value = feature.properties.label;

      // Toon resultaatsectie
      document.getElementById("results").style.display = "block";
      document.getElementById("normalizedAddress").textContent = feature.properties.label;
      
      // Toon coordinaten (handig om te weten dat het echt werkt)
      const coords = feature.geometry.coordinates; // [lon, lat]
      document.getElementById("gpsCoords").textContent = coords[1] + ", " + coords[0];

      // Render de content
      renderResults();
    }

    // 5. Render Kaarten & Lijsten
    function renderResults() {
      const container = document.getElementById("techCards");
      const internet = providersData && providersData.internet ? providersData.internet : {};
      
      // Helper om providers te tonen
      const listLinks = (arr) => {
        if(!arr) return "";
        return arr.map(p => `<a href="${p.url}" target="_blank">${p.name}</a>`).join("<br>");
      };

      container.innerHTML = `
        <div class="tech-card">
          <span class="pill">Fibre</span>
          <h3>Glasvezel</h3>
          <p>Check beschikbaarheid bij:</p>
          <div class="links-list">${listLinks(internet.fibre)}</div>
        </div>
        <div class="tech-card">
          <span class="pill">4G/5G</span>
          <h3>4G/5G Box</h3>
          <p>Check dekking bij:</p>
          <div class="links-list">${listLinks(internet["4g5g"])}</div>
        </div>
        <div class="tech-card">
          <span class="pill">Starlink</span>
          <h3>Satelliet (LEO)</h3>
          <div class="links-list">${listLinks(internet.leo)}</div>
        </div>
      `;

      // TV en VPN renderen
      const tvList = document.getElementById("tvList");
      const vpnList = document.getElementById("vpnList");
      
      if(providersData && providersData.tv) {
         let tvHtml = "";
         providersData.tv.nl.forEach(t => tvHtml += `<li>${t.name} (<a href="${t.url}" target="_blank">link</a>)</li>`);
         tvList.innerHTML = tvHtml;
      }
      
      if(providersData && providersData.vpn) {
         let vpnHtml = "";
         providersData.vpn.forEach(v => vpnHtml += `<li>${v.name} - ${v.type} (<a href="${v.url}" target="_blank">site</a>)</li>`);
         vpnList.innerHTML = vpnHtml;
      }
    }

    // Start
    document.addEventListener("DOMContentLoaded", loadProviders);
    
    // Klik buiten dropdown sluit hem
    document.addEventListener('click', function(e) {
      const container = document.querySelector('.search-container');
      if (!container.contains(e.target)) {
        document.getElementById("addressSuggestions").style.display = 'none';
      }
    });
  </script>
</body>
</html>
